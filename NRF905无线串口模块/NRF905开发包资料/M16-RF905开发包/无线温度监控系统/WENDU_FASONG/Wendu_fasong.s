	.module Wendu_fasong.c
	.area text(rom, con, rel)
	.dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线温度监控系统\FASONG\Wendu_fasong.c
	.area data(ram, con, rel)
	.dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线温度监控系统\FASONG\Wendu_fasong.c
_temp_data::
	.blkb 2
	.area idata
	.byte 0,0
	.area data(ram, con, rel)
	.dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线温度监控系统\FASONG\Wendu_fasong.c
	.dbsym e temp_data _temp_data A[2:2]c
_seg::
	.blkb 2
	.area idata
	.byte 192,207
	.area data(ram, con, rel)
	.dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线温度监控系统\FASONG\Wendu_fasong.c
	.blkb 2
	.area idata
	.byte 164,176
	.area data(ram, con, rel)
	.dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线温度监控系统\FASONG\Wendu_fasong.c
	.blkb 2
	.area idata
	.byte 153,146
	.area data(ram, con, rel)
	.dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线温度监控系统\FASONG\Wendu_fasong.c
	.blkb 2
	.area idata
	.byte 130,248
	.area data(ram, con, rel)
	.dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线温度监控系统\FASONG\Wendu_fasong.c
	.blkb 2
	.area idata
	.byte 128,144
	.area data(ram, con, rel)
	.dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线温度监控系统\FASONG\Wendu_fasong.c
	.dbsym e seg _seg A[10:10]c
_seg1::
	.blkb 2
	.area idata
	.byte 64,'O
	.area data(ram, con, rel)
	.dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线温度监控系统\FASONG\Wendu_fasong.c
	.blkb 2
	.area idata
	.byte 36,48
	.area data(ram, con, rel)
	.dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线温度监控系统\FASONG\Wendu_fasong.c
	.blkb 2
	.area idata
	.byte 25,18
	.area data(ram, con, rel)
	.dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线温度监控系统\FASONG\Wendu_fasong.c
	.blkb 2
	.area idata
	.byte 2,'x
	.area data(ram, con, rel)
	.dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线温度监控系统\FASONG\Wendu_fasong.c
	.blkb 2
	.area idata
	.byte 0,16
	.area data(ram, con, rel)
	.dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线温度监控系统\FASONG\Wendu_fasong.c
	.dbsym e seg1 _seg1 A[10:10]c
_TxAddress::
	.blkb 2
	.area idata
	.byte 204,204
	.area data(ram, con, rel)
	.dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线温度监控系统\FASONG\Wendu_fasong.c
	.blkb 2
	.area idata
	.byte 204,204
	.area data(ram, con, rel)
	.dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线温度监控系统\FASONG\Wendu_fasong.c
	.dbsym e TxAddress _TxAddress A[4:4]c
_RFConf::
	.blkb 2
	.area idata
	.byte 0,'L
	.area data(ram, con, rel)
	.dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线温度监控系统\FASONG\Wendu_fasong.c
	.blkb 2
	.area idata
	.byte 12,'D
	.area data(ram, con, rel)
	.dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线温度监控系统\FASONG\Wendu_fasong.c
	.blkb 2
	.area idata
	.byte 4,4
	.area data(ram, con, rel)
	.dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线温度监控系统\FASONG\Wendu_fasong.c
	.blkb 2
	.area idata
	.byte 204,204
	.area data(ram, con, rel)
	.dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线温度监控系统\FASONG\Wendu_fasong.c
	.blkb 2
	.area idata
	.byte 204,204
	.area data(ram, con, rel)
	.dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线温度监控系统\FASONG\Wendu_fasong.c
	.blkb 1
	.area idata
	.byte 'X
	.area data(ram, con, rel)
	.dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线温度监控系统\FASONG\Wendu_fasong.c
	.dbsym e RFConf _RFConf A[11:11]c
	.area text(rom, con, rel)
	.dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线温度监控系统\FASONG\Wendu_fasong.c
	.dbfunc e delay _delay fV
;              i -> R20,R21
;              x -> R16,R17
	.even
_delay::
	xcall push_gset1
	.dbline -1
	.dbline 127
; //ICC-AVR application builder : 2007-8-11 20:37:32
; // Target : M16
; // Triter : chenjia
; // Crystal: 8.0000Mhz
; #include <iom16v.h>
; #include <macros.h>
; //------------------------------------------------------------------------------
; #define uint  unsigned int
; #define uchar unsigned char
; //----------------------------温度变量------------------------------------------
; uchar  temp_data[2]={0x00,0x00};
; uchar  dispaly[7];
; uchar seg[10]={0xC0,0xCF,0xA4,0xB0,0x99,0x92,0x82,0xF8,0x80,0x90};         //0~~9段码
; uchar seg1[10]={0x40,0x4F,0x24,0x30,0x19,0x12,0x02,0x78,0x00,0x10}; 
; //******************************************************************************
; //***********************DS18B20--------PD6*************************************
; //******************************************************************************
; #define   In_DQ      DDRD &= ~(1 << PD6)       
; #define   Out_DQ     DDRD |= (1 << PD6) 
; //------------------------------------------------------------------------------
; #define   Hign_DQ    PORTD |= (1 << PD6)   
; #define   Low_DQ     PORTD &= ~(1 << PD6)
; //------------------------------------------------------------------------------
; #define   Read_DQ    PIND & (1 << PD6)
; //******************************************************************************
; //***********************NRF905端口设置*****************************************
; //******************************************************************************
; ///////////////////////////模式控制定义/////////////////////////////////
; //#define  nrf905_TX_EN	  PB0	    //输出1
; #define   Hign_nrf905_TX_EN    PORTB |= (1 << PB0);   
; #define   Low_nrf905_TX_EN     PORTB &= ~(1 << PB0); 
; //#define  nrf905_TRX_CE  PD4 	    //输出1
; #define   Hign_nrf905_TRX_CE    PORTD |= (1 << PD4);   
; #define   Low_nrf905_TRX_CE     PORTD &= ~(1 << PD4); 
; //#define  nrf905_PWR     PB1 	    //输出1
; #define   Hign_nrf905_PWR    PORTB |= (1 << PB1);   
; #define   Low_nrf905_PWR     PORTB &= ~(1 << PB1); 
; ///////////////////////////SPI口定义////////////////////////////////////
; //#define  nrf905_MISO	  PB6   	//输入0
; //#define  nrf905_MOSI    PB5	    //输出1
; //#define  nrf905_SCK     PB7	    //输出1
; #define   Low_nrf905_SCK     PORTB &= ~(1 << PB7); 
; ////////////////////////////////////////////////////////////////////////
; //#define  nrf905_CSN     PB4		//输出1		
; #define   Hign_nrf905_CSN    PORTB |= (1 << PB4);   
; #define   Low_nrf905_CSN     PORTB &= ~(1 << PB4); 						
; ///////////////////////////状态输出口///////////////////////////////////
; //#define  nrf905_CD      PD3	    //输入0
; #define   Hign_nrf905_CD    PORTD |= (1 << PD3);   
; #define   Low_nrf905_CD     PORTD &= ~(1 << PD3); 
; #define   Read_nrf905_CD    PINB & (1 << PD3);
; //#define  nrf905_AM      PB3	    //输入0
; #define   Hign_nrf905_AM    PORTB |= (1 << PB3);   
; #define   Low_nrf905_AM     PORTB &= ~(1 << PB3); 
; #define   Read_nrf905_AM    PINB & (1 << PB3);
; //#define  nrf905_DR      PB2  		//输入0
; #define   Hign_nrf905_DR     PORTB |= (1 << PB2);   
; #define   Low_nrf905_DR     PORTB &= ~(1 << PB2); 
; #define   Read_nrf905_DR    PINB & (1 << PB2);
; //------------------------------数码管位选--------------------------------------
; //#define Display1   PA1  		    //输出1
; #define   Hign_Display1     PORTA |= (1 << PA1);   
; #define   Low_Display1    PORTA &= ~(1 << PA1); 
; //#define Display2      PA2  		//输出1
; #define   Hign_Display2     PORTA |= (1 << PA2);   
; #define   Low_Display2    PORTA &= ~(1 << PA2); 
; //#define Display3     PA3  		//输出1
; #define   Hign_Display3     PORTA |= (1 << PA3);   
; #define   Low_Display3     PORTA &= ~(1 << PA3); 
; //#define Display4      PA4 		//输出1
; #define   Hign_Display4     PORTA |= (1 << PA4);   
; #define   Low_Display4     PORTA &= ~(1 << PA4);   
; //-------------------------------BELL蜂明器-------------------------------------
; #define   Hign_BELL  PORTD |= (1 << PD5);   
; #define   Low_BELL     PORTD &= ~(1 << PD5); 
; //-------------------------------JDQ继电器--------------------------------------
; #define   Hign_JDQ  PORTD |= (1 << PD7)
; #define   Low_JDQ     PORTD &= ~(1 << PD7) 
; //----------------------------------905-SPI指令---------------------------------
; #define WC	0x00
; #define RRC	0x10
; #define WTP	0x20
; #define RTP	0x21
; #define WTA	0x22
; #define RTA	0x23
; #define RRP	0x24
; //---------------------------------发送数据-------------------------------------
; uchar TxRxBuf[4] ;
; //----------------------------------接收地址------------------------------------
; uchar TxAddress[4]={0xcc,0xcc,0xcc,0xcc };    
; //----------------------------------寄存器配置----------------------------------
; uchar RFConf[11]=
; {
;   0x00,                             //配置命令//
;   0x4c,                             //CH_NO,配置频段在430MHZ
;   0x0C,                             //输出功率为10db,不重发，节电为正常模式
;   0x44,                             //地址宽度设置，为4字节
;   0x04,0x04,                        //接收发送有效数据长度为4字节
;   0xCC,0xCC,0xCC,0xCC,              //接收地址
;   0x58,                              //CRC充许，8位CRC校验，外部时钟信号不使能，16M晶振
; };
; //----------------------------------函数申明------------------------------------
; void delay(uint x);
; void Spi_initial();
; uchar SpiReadSpiWrite(uchar DATA);
; void system_Init(void);
; void Config905(void);
; void TxPacket(void);
; void SetTxMode(void);
; void TX(void);
; void StartUART(void);
; void R_S_Byte(uchar R_Byte);
; //------------------------------------------------------------------------------
; void Init_DS18B20(void);
; uchar ReadOneChar(void);
; void WriteOneChar(uchar dat);
; void ReadTemperature(void);
; void work_temp();
; void StartUART(void);
; void R_S_Byte(uchar R_Byte);
; void DS1820_delay(uint i);
; //------------------------------------------------------------------------------
; //**********************************NRF905驱动**********************************
; //******************************************************************************
; //----------------------------------100us延时子程序-----------------------------
; void delay(uint x)
; {
	xjmp L3
L2:
	.dbline 130
	clr R20
	clr R21
	xjmp L8
L5:
	.dbline 130
L6:
	.dbline 130
	subi R20,255  ; offset = 1
	sbci R21,255
L8:
	.dbline 130
	cpi R20,80
	ldi R30,0
	cpc R21,R30
	brlo L5
L3:
	.dbline 129
; 	uint i;
; 	while(x--)
	movw R2,R16
	subi R16,1
	sbci R17,0
	tst R2
	brne L2
	tst R3
	brne L2
X0:
	.dbline -2
L1:
	xcall pop_gset1
	.dbline 0 ; func end
	ret
	.dbsym r i 20 i
	.dbsym r x 16 i
	.dbend
	.dbfunc e Spi_initial _Spi_initial fV
	.even
_Spi_initial::
	.dbline -1
	.dbline 134
; 	for(i=0;i<80;i++);
; }
; //----------------------------------SPI初始化-----------------------------------
; void Spi_initial()
; {
	.dbline 137
; 	//SPCR=0x50;
; 	//SPSR=0x00;	
; 	SPCR   = (1<<SPE)|(1<<MSTR)|(0<<CPOL)|(0<<SPR0);   // 主机模式，fck/16, SPI方式0
	ldi R24,80
	out 0xd,R24
	.dbline -2
L9:
	.dbline 0 ; func end
	ret
	.dbend
	.dbfunc e SpiReadSpiWrite _SpiReadSpiWrite fc
;          cData -> R16
	.even
_SpiReadSpiWrite::
	.dbline -1
	.dbline 141
; }
; //---------------------------------SPI读写程序----------------------------------	
; uchar SpiReadSpiWrite(unsigned char cData)//r
; {
	.dbline 142
; 	SPDR = cData;
	out 0xf,R16
L11:
	.dbline 144
	.dbline 144
L12:
	.dbline 143
; 	while(!(SPSR & (1<<SPIF) ))
	sbis 0xe,7
	rjmp L11
	.dbline 144
; 	{};			// 等待SPI发送完毕
	.dbline 145
; 	return SPDR;
	in R16,0xf
	.dbline -2
L10:
	.dbline 0 ; func end
	ret
	.dbsym r cData 16 c
	.dbend
	.dbfunc e system_Init _system_Init fV
	.even
_system_Init::
	.dbline -1
	.dbline 149
; }
; //---------------------------------系统状态初始化-------------------------------
; void system_Init(void)			//r
; {
	.dbline 151
; 
;    	Hign_nrf905_CSN;				// Spi 	disable
	sbi 0x18,4
	.dbline 151
	.dbline 152
; 	Low_nrf905_SCK;				// Spi clock line init low
	cbi 0x18,7
	.dbline 152
	.dbline 153
; 	Low_nrf905_DR;				// Init DR for input
	cbi 0x18,2
	.dbline 153
	.dbline 154
; 	Low_nrf905_AM;				// Init AM for input
	cbi 0x18,3
	.dbline 154
	.dbline 155
; 	Low_nrf905_CD;				// Init nrf905_CDfor input
	cbi 0x12,3
	.dbline 155
	.dbline 156
; 	Hign_nrf905_PWR;				// nRF905 power on
	sbi 0x18,1
	.dbline 156
	.dbline 157
; 	Low_nrf905_TRX_CE;			// Set nRF905 in standby mode
	cbi 0x12,4
	.dbline 157
	.dbline 158
; 	Low_nrf905_TX_EN ;			// set radio in Rx mode
	cbi 0x18,0
	.dbline 158
	.dbline -2
L14:
	.dbline 0 ; func end
	ret
	.dbend
	.dbfunc e Config905 _Config905 fV
;              i -> R20
	.even
_Config905::
	xcall push_gset1
	.dbline -1
	.dbline 162
; }
; //--------------------------------NRF905寄存器初始化函数------------------------
; void Config905(void)
; {
	.dbline 164
; 	uchar i;
; 	Low_nrf905_CSN;	
	cbi 0x18,4
	.dbline 164
	.dbline 165
; 	delay(1);				// Spi enable for write a spi command
	ldi R16,1
	ldi R17,0
	xcall _delay
	.dbline 167
; 	//SpiWrite(WC);				// Write config command写放配置命令
; 	for (i=0;i<11;i++)			// Write configration words  写放配置字
	clr R20
	xjmp L19
L16:
	.dbline 168
	.dbline 169
	ldi R24,<_RFConf
	ldi R25,>_RFConf
	mov R30,R20
	clr R31
	add R30,R24
	adc R31,R25
	ldd R16,z+0
	xcall _SpiReadSpiWrite
	.dbline 170
L17:
	.dbline 167
	inc R20
L19:
	.dbline 167
	cpi R20,11
	brlo L16
	.dbline 171
; 	{
; 	 SpiReadSpiWrite(RFConf[i]);
; 	}
; 	Hign_nrf905_CSN;					// Disable Spi
	sbi 0x18,4
	.dbline 171
	.dbline -2
L15:
	xcall pop_gset1
	.dbline 0 ; func end
	ret
	.dbsym r i 20 c
	.dbend
	.dbfunc e TxPacket _TxPacket fV
;              i -> R20
	.even
_TxPacket::
	xcall push_gset1
	.dbline -1
	.dbline 175
; }
; //--------------------------------NRF905待发数据打包----------------------------
; void TxPacket(void)
; {
	.dbline 177
; 	uchar i;
; 	Low_nrf905_CSN;		   				// 使能Spi，允许对nrf905进行读写操作
	cbi 0x18,4
	.dbline 177
	.dbline 178
; 	delay(1);
	ldi R16,1
	ldi R17,0
	xcall _delay
	.dbline 179
; 	SpiReadSpiWrite(WTP);				// 写数据前先写写数据命令
	ldi R16,32
	xcall _SpiReadSpiWrite
	.dbline 180
; 	for (i=0;i<4;i++)
	clr R20
	xjmp L24
L21:
	.dbline 181
	.dbline 182
	ldi R24,<_dispaly
	ldi R25,>_dispaly
	mov R30,R20
	clr R31
	add R30,R24
	adc R31,R25
	ldd R16,z+0
	xcall _SpiReadSpiWrite
	.dbline 183
L22:
	.dbline 180
	inc R20
L24:
	.dbline 180
	cpi R20,4
	brlo L21
	.dbline 184
; 	{
; 	SpiReadSpiWrite(  dispaly[i]);		// 待发送的32字节数据
; 	}						
; 	Hign_nrf905_CSN;
	sbi 0x18,4
	.dbline 184
	.dbline 185
; 	delay(1);							// 关闭Spi，不允许对nrf905进行读写操作
	ldi R16,1
	ldi R17,0
	xcall _delay
	.dbline 186
; 	Low_nrf905_CSN;								// 使能Spi
	cbi 0x18,4
	.dbline 186
	.dbline 187
; 	SpiReadSpiWrite(WTA);				// 写地址前首先先写地址命令
	ldi R16,34
	xcall _SpiReadSpiWrite
	.dbline 188
; 	for (i=0;i<4;i++)					// 写 4 bytes 地址
	clr R20
	xjmp L28
L25:
	.dbline 189
	.dbline 190
	ldi R24,<_TxAddress
	ldi R25,>_TxAddress
	mov R30,R20
	clr R31
	add R30,R24
	adc R31,R25
	ldd R16,z+0
	xcall _SpiReadSpiWrite
	.dbline 191
L26:
	.dbline 188
	inc R20
L28:
	.dbline 188
	cpi R20,4
	brlo L25
	.dbline 192
; 	{
; 	SpiReadSpiWrite(TxAddress[i]);
; 	}
; 	Hign_nrf905_CSN;					// 关闭Spi
	sbi 0x18,4
	.dbline 192
	.dbline 193
; 	Hign_nrf905_TRX_CE;					// Set TRX_CE high,start Tx data transmission
	sbi 0x12,4
	.dbline 193
	.dbline 194
; 	delay(1);							// 等待DR变高
	ldi R16,1
	ldi R17,0
	xcall _delay
	.dbline 195
; 	Low_nrf905_TRX_CE;							// 设置TRX_CE=0
	cbi 0x12,4
	.dbline 195
	.dbline -2
L20:
	xcall pop_gset1
	.dbline 0 ; func end
	ret
	.dbsym r i 20 c
	.dbend
	.dbfunc e SetTxMode _SetTxMode fV
	.even
_SetTxMode::
	.dbline -1
	.dbline 199
; }
; //-------------------------------发送模式激发-----------------------------------
; void SetTxMode(void)
; {
	.dbline 200
; 	Low_nrf905_TRX_CE;				//
	cbi 0x12,4
	.dbline 200
	.dbline 201
; 	Hign_nrf905_TX_EN;				//发送使能
	sbi 0x18,0
	.dbline 201
	.dbline 202
; 	delay(2); 				// delay for mode change(>=650us)根据晶振不同要改变
	ldi R16,2
	ldi R17,0
	xcall _delay
	.dbline -2
L29:
	.dbline 0 ; func end
	ret
	.dbend
	.dbfunc e TX _TX fV
	.even
_TX::
	.dbline -1
	.dbline 206
; }
; //------------------------------------------------------------------------------
; void TX(void)
; {
	.dbline 207
;      SetTxMode();	   // Set nRF905 in Tx mode
	xcall _SetTxMode
	.dbline 208
; 	 TxPacket();			   // Send data by nRF905
	xcall _TxPacket
	.dbline -2
L30:
	.dbline 0 ; func end
	ret
	.dbend
	.dbfunc e DS1820_delay _DS1820_delay fV
;              i -> R16,R17
	.even
_DS1820_delay::
	.dbline -1
	.dbline 216
; }
; //******************************************************************************
; //**********************************DS18B20温度采集*****************************
; //******************************************************************************
; 
; //----------------------------------延时函数------------------------------------
; void DS1820_delay(uint i)
; {
L32:
	.dbline 217
L33:
	.dbline 217
; 	while(i--);
	movw R2,R16
	subi R16,1
	sbci R17,0
	tst R2
	brne L32
	tst R3
	brne L32
X1:
	.dbline -2
L31:
	.dbline 0 ; func end
	ret
	.dbsym r i 16 i
	.dbend
	.dbfunc e Init_DS18B20 _Init_DS18B20 fV
;              x -> R20
	.even
_Init_DS18B20::
	xcall push_gset1
	.dbline -1
	.dbline 221
; }
; //---------------------------------DS18B20初始化--------------------------------
; void Init_DS18B20(void)
; {
	.dbline 222
;     unsigned char x=1;
	ldi R20,1
	.dbline 224
; 	
; 	Out_DQ;                //配置输出
	sbi 0x11,6
	.dbline 225
; 	Hign_DQ;              //置高电平
	sbi 0x12,6
	.dbline 226
; 	Low_DQ;			     //置低电平
	cbi 0x12,6
	.dbline 227
; 	DS1820_delay(3000);	    //400-960us
	ldi R16,3000
	ldi R17,11
	xcall _DS1820_delay
	.dbline 228
; 	Hign_DQ;		   //置高电平
	sbi 0x12,6
	.dbline 229
; 	In_DQ ;
	cbi 0x11,6
	.dbline 230
; 	DS1820_delay(40);		  //15-60us
	ldi R16,40
	ldi R17,0
	xcall _DS1820_delay
L36:
	.dbline 231
L37:
	.dbline 231
; 	while(Read_DQ)	 ; 
	sbic 0x10,6
	rjmp L36
	.dbline 232
; 	Out_DQ ;
	sbi 0x11,6
	.dbline 233
; 	Hign_DQ;
	sbi 0x12,6
	.dbline 234
; 	DS1820_delay(300);	
	ldi R16,300
	ldi R17,1
	xcall _DS1820_delay
	.dbline -2
L35:
	xcall pop_gset1
	.dbline 0 ; func end
	ret
	.dbsym r x 20 c
	.dbend
	.dbfunc e ReadOneChar _ReadOneChar fc
;            dat -> R20
;              i -> R22
	.even
_ReadOneChar::
	xcall push_gset2
	.dbline -1
	.dbline 238
; }
; //---------------------------------DS18B20读函数--------------------------------
; uchar ReadOneChar(void)
; {
	.dbline 240
;     uchar i;
; 	uchar dat = 0;
	clr R20
	.dbline 242
; 	
; 	for(i=8;i>0;i--)
	ldi R22,8
	xjmp L43
L40:
	.dbline 243
; 	{
	.dbline 244
; 	    Out_DQ;    //配置输出
	sbi 0x11,6
	.dbline 245
; 	    Low_DQ;   //置低电平
	cbi 0x12,6
	.dbline 246
; 		dat >>= 1;
	lsr R20
	.dbline 247
; 		Hign_DQ; //置高电平
	sbi 0x12,6
	.dbline 248
; 		In_DQ;  //设置输入
	cbi 0x11,6
	.dbline 249
; 		if(Read_DQ)//读取电平
	sbis 0x10,6
	rjmp L44
	.dbline 250
;         {
	.dbline 251
; 		dat |= 0x80;
	ori R20,128
	.dbline 252
;         }
L44:
	.dbline 253
	sbi 0x11,6
	.dbline 254
	ldi R16,50
	ldi R17,0
	xcall _DS1820_delay
	.dbline 255
L41:
	.dbline 242
	dec R22
L43:
	.dbline 242
	ldi R24,0
	cp R24,R22
	brlo L40
	.dbline 256
; 		Out_DQ;//配置输出
;         DS1820_delay(50);
; 	}
; 	return(dat);
	mov R16,R20
	.dbline -2
L39:
	xcall pop_gset2
	.dbline 0 ; func end
	ret
	.dbsym r dat 20 c
	.dbsym r i 22 c
	.dbend
	.dbfunc e WriteOneChar _WriteOneChar fV
;              i -> R20
;            dat -> R22
	.even
_WriteOneChar::
	xcall push_gset2
	mov R22,R16
	.dbline -1
	.dbline 260
; }
; //------------------------------DS18B20写函数-----------------------------------
; void WriteOneChar(uchar dat)
; {
	.dbline 262
;     uchar i;
; 	Out_DQ;//配置输出
	sbi 0x11,6
	.dbline 263
; 	for(i=8;i>0;i--)
	ldi R20,8
	xjmp L50
L47:
	.dbline 264
; 	{
	.dbline 265
; 	    Low_DQ;//置低电平
	cbi 0x12,6
	.dbline 266
; 		if(dat&0x01)//写电平
	sbrs R22,0
	rjmp L51
	.dbline 267
;         {
	.dbline 268
;         Hign_DQ;//置高电平
	sbi 0x12,6
	.dbline 269
;         }
	xjmp L52
L51:
	.dbline 271
;         else
;         {
	.dbline 272
;          Low_DQ;//置低电平
	cbi 0x12,6
	.dbline 273
;         }
L52:
	.dbline 274
	ldi R16,40
	ldi R17,0
	xcall _DS1820_delay
	.dbline 275
	sbi 0x12,6
	.dbline 276
	lsr R22
	.dbline 277
L48:
	.dbline 263
	dec R20
L50:
	.dbline 263
	ldi R24,0
	cp R24,R20
	brlo L47
	.dbline 278
; 		DS1820_delay(40);
; 		Hign_DQ;//置高电平
; 		dat >>= 1;
; 	}
; 	DS1820_delay(8);
	ldi R16,8
	ldi R17,0
	xcall _DS1820_delay
	.dbline -2
L46:
	xcall pop_gset2
	.dbline 0 ; func end
	ret
	.dbsym r i 20 c
	.dbsym r dat 22 c
	.dbend
	.dbfunc e ReadTemperature _ReadTemperature fV
	.even
_ReadTemperature::
	.dbline -1
	.dbline 282
; }
; //------------------------------------读取温度------------------------------------
; void ReadTemperature(void)
; {		
	.dbline 283
; 	Init_DS18B20();
	xcall _Init_DS18B20
	.dbline 284
; 	WriteOneChar(0xCC); 			// 跳过读序号列号的操作
	ldi R16,204
	xcall _WriteOneChar
	.dbline 285
; 	WriteOneChar(0x44); 			// 启动温度转换
	ldi R16,68
	xcall _WriteOneChar
	.dbline 288
; 	
; 	
; 	Init_DS18B20();
	xcall _Init_DS18B20
	.dbline 289
; 	WriteOneChar(0xCC); 			//跳过读序号列号的操作
	ldi R16,204
	xcall _WriteOneChar
	.dbline 290
; 	WriteOneChar(0xBE); 			//读取温度寄存器等（共可读9个寄存器） 前两个就是温度
	ldi R16,190
	xcall _WriteOneChar
	.dbline 292
; 
; 	temp_data[0]= ReadOneChar();   		//读取温度值低位LSB
	xcall _ReadOneChar
	sts _temp_data,R16
	.dbline 293
; 	temp_data[1]= ReadOneChar();   //读取温度值高位MSB
	xcall _ReadOneChar
	sts _temp_data+1,R16
	.dbline -2
L53:
	.dbline 0 ; func end
	ret
	.dbend
	.dbfunc e work_temp _work_temp fV
	.area func_lit(rom, con, rel)
L90:
	.word `L89
	.word `L88
	.word `L87
	.word `L86
	.word `L85
	.word `L84
	.word `L83
	.word `L82
	.word `L81
	.word `L80
	.word `L79
	.word `L78
	.word `L77
	.word `L76
	.word `L75
	.word `L74
	.area text(rom, con, rel)
	.dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线温度监控系统\FASONG\Wendu_fasong.c
;              n -> R20
	.even
_work_temp::
	xcall push_gset2
	.dbline -1
	.dbline 303
; 	
; }
; //-----------------------------------BCD码温度处理------------------------------
; //dispaly[0]十位
; //dispaly[1]个位
; //dispaly[2]小数位
; //dispaly[3]临界标志位
; //------------------------------------------------------------------------------
; void work_temp()
; {
	.dbline 304
; 	uchar n=0;
	clr R20
	.dbline 305
; 	if(temp_data[1]>127)
	ldi R24,127
	lds R2,_temp_data+1
	cp R24,R2
	brsh L56
	.dbline 306
; 	{
	.dbline 307
; 	temp_data[1]=(256-temp_data[1]);
	clr R3
	ldi R24,256
	ldi R25,1
	sub R24,R2
	sbc R25,R3
	sts _temp_data+1,R24
	.dbline 308
; 	temp_data[0]=(256-temp_data[0]);
	lds R2,_temp_data
	clr R3
	ldi R24,256
	ldi R25,1
	sub R24,R2
	sbc R25,R3
	sts _temp_data,R24
	.dbline 309
; 	n=1;
	ldi R20,1
	.dbline 310
; 	}
L56:
	.dbline 312
; //------------------------------------------------------------------------------
; 	dispaly[6]=((temp_data[0]&0xf0)>>4)|((temp_data[1]&0x0f)<<4);
	lds R24,_temp_data+1
	andi R24,15
	andi R24,#0x0F
	swap R24
	lds R25,_temp_data
	andi R25,240
	swap R25
	andi R25,#0x0F
	or R25,R24
	sts _dispaly+6,R25
	.dbline 313
; 	dispaly[5]=dispaly[6]/100;				//百位
	ldi R17,100
	mov R16,R25
	xcall div8u
	sts _dispaly+5,R16
	.dbline 314
; 	dispaly[4]=dispaly[6]%100;				//
	ldi R17,100
	lds R16,_dispaly+6
	xcall mod8u
	sts _dispaly+4,R16
	.dbline 315
; 	dispaly[2]=dispaly[4]/10;               //十位
	ldi R17,10
	xcall div8u
	sts _dispaly+2,R16
	.dbline 316
; 	dispaly[1]=dispaly[4]%10;			    //个位
	ldi R17,10
	lds R16,_dispaly+4
	xcall mod8u
	sts _dispaly+1,R16
	.dbline 318
; 	
; 	switch	(temp_data[0]&0x0f)
	lds R22,_temp_data
	clr R23
	andi R22,15
	andi R23,0
	cpi R22,0
	ldi R30,0
	cpc R23,R30
	brge X3
	xjmp L72
X3:
	ldi R24,15
	ldi R25,0
	cp R24,R22
	cpc R25,R23
	brge X4
	xjmp L72
X4:
	ldi R16,2
	ldi R17,0
	movw R18,R22
	xcall empy16s
	movw R30,R16
	ldi R24,<L90
	ldi R25,>L90
	add R30,R24
	adc R31,R25
	lpm R0,Z+
	lpm R1,Z
	movw R30,R0
	ijmp
X2:
	.dbline 319
; 	{
L74:
	.dbline 320
; 	case 0x0f:dispaly[0]=9;break;
	ldi R24,9
	sts _dispaly,R24
	.dbline 320
	xjmp L72
L75:
	.dbline 321
; 	case 0x0e:dispaly[0]=9;break;
	ldi R24,9
	sts _dispaly,R24
	.dbline 321
	xjmp L72
L76:
	.dbline 322
; 	case 0x0d:dispaly[0]=8;break;
	ldi R24,8
	sts _dispaly,R24
	.dbline 322
	xjmp L72
L77:
	.dbline 323
; 	case 0x0c:dispaly[0]=8;break;
	ldi R24,8
	sts _dispaly,R24
	.dbline 323
	xjmp L72
L78:
	.dbline 324
; 	case 0x0b:dispaly[0]=7;break;
	ldi R24,7
	sts _dispaly,R24
	.dbline 324
	xjmp L72
L79:
	.dbline 325
; 	case 0x0a:dispaly[0]=6;break;
	ldi R24,6
	sts _dispaly,R24
	.dbline 325
	xjmp L72
L80:
	.dbline 326
; 	case 0x09:dispaly[0]=6;break;
	ldi R24,6
	sts _dispaly,R24
	.dbline 326
	xjmp L72
L81:
	.dbline 327
; 	case 0x08:dispaly[0]=5;break;
	ldi R24,5
	sts _dispaly,R24
	.dbline 327
	xjmp L72
L82:
	.dbline 328
; 	case 0x07:dispaly[0]=4;break;
	ldi R24,4
	sts _dispaly,R24
	.dbline 328
	xjmp L72
L83:
	.dbline 329
; 	case 0x06:dispaly[0]=4;break;
	ldi R24,4
	sts _dispaly,R24
	.dbline 329
	xjmp L72
L84:
	.dbline 330
; 	case 0x05:dispaly[0]=3;break;
	ldi R24,3
	sts _dispaly,R24
	.dbline 330
	xjmp L72
L85:
	.dbline 331
; 	case 0x04:dispaly[0]=3;break;
	ldi R24,3
	sts _dispaly,R24
	.dbline 331
	xjmp L72
L86:
	.dbline 332
; 	case 0x03:dispaly[0]=2;break;
	ldi R24,2
	sts _dispaly,R24
	.dbline 332
	xjmp L72
L87:
	.dbline 333
; 	case 0x02:dispaly[0]=1;break;
	ldi R24,1
	sts _dispaly,R24
	.dbline 333
	xjmp L72
L88:
	.dbline 334
; 	case 0x01:dispaly[0]=1;break;
	ldi R24,1
	sts _dispaly,R24
	.dbline 334
	xjmp L72
L89:
	.dbline 335
; 	case 0x00:dispaly[0]=0;break;
	clr R2
	sts _dispaly,R2
	.dbline 335
	.dbline 336
; 	default:break;
L72:
	.dbline 338
; 	}
; 		if(n)								//温度正负区分
	tst R20
	breq L91
	.dbline 339
; 	{
	.dbline 340
; 	dispaly[3]=0x11;						//零下
	ldi R24,17
	sts _dispaly+3,R24
	.dbline 341
; 	}
	xjmp L92
L91:
	.dbline 343
	.dbline 344
	ldi R24,34
	sts _dispaly+3,R24
	.dbline 345
L92:
	.dbline -2
L55:
	xcall pop_gset2
	.dbline 0 ; func end
	ret
	.dbsym r n 20 c
	.dbend
	.dbfunc e dis_zhuye _dis_zhuye fV
	.even
_dis_zhuye::
	.dbline -1
	.dbline 350
; 	else
; 	{
; 	dispaly[3]=0x22;				  	//零上
; 	}
; }
; 
; //------------------------------------------------------------------------------
; void dis_zhuye()
; {
	.dbline 351
; 	 PORTC=seg[dispaly[2]];
	ldi R24,<_seg
	ldi R25,>_seg
	lds R30,_dispaly+2
	clr R31
	add R30,R24
	adc R31,R25
	ldd R2,z+0
	out 0x15,R2
	.dbline 352
; 	 Hign_Display4;
	sbi 0x1b,4
	.dbline 352
	.dbline 353
; 	 Hign_Display3;
	sbi 0x1b,3
	.dbline 353
	.dbline 354
; 	 Hign_Display2;
	sbi 0x1b,2
	.dbline 354
	.dbline 355
; 	 Low_Display1;
	cbi 0x1b,1
	.dbline 355
	.dbline 356
; 	 delay(80);
	ldi R16,80
	ldi R17,0
	xcall _delay
	.dbline 357
; 	 Hign_Display1;
	sbi 0x1b,1
	.dbline 357
	.dbline 359
; //------------------------------------------------------------------------------
; 	 PORTC=seg1[dispaly[1]];
	ldi R24,<_seg1
	ldi R25,>_seg1
	lds R30,_dispaly+1
	clr R31
	add R30,R24
	adc R31,R25
	ldd R2,z+0
	out 0x15,R2
	.dbline 360
; 	 Low_Display2;
	cbi 0x1b,2
	.dbline 360
	.dbline 361
; 	 delay(80);
	ldi R16,80
	ldi R17,0
	xcall _delay
	.dbline 362
; 	 Hign_Display2;
	sbi 0x1b,2
	.dbline 362
	.dbline 364
; //------------------------------------------------ ---------------------------
; 	 PORTC=seg[dispaly[0]];
	ldi R24,<_seg
	ldi R25,>_seg
	lds R30,_dispaly
	clr R31
	add R30,R24
	adc R31,R25
	ldd R2,z+0
	out 0x15,R2
	.dbline 365
; 	 Low_Display3;
	cbi 0x1b,3
	.dbline 365
	.dbline 366
; 	 delay(80);
	ldi R16,80
	ldi R17,0
	xcall _delay
	.dbline 367
; 	 Hign_Display3;
	sbi 0x1b,3
	.dbline 367
	.dbline 369
; //----------------------------------------------------------------------------- 
; 	 PORTC=0xc6;
	ldi R24,198
	out 0x15,R24
	.dbline 370
; 	 Low_Display4;
	cbi 0x1b,4
	.dbline 370
	.dbline 371
; 	 delay(80);
	ldi R16,80
	ldi R17,0
	xcall _delay
	.dbline 372
; 	 Hign_Display4;	 
	sbi 0x1b,4
	.dbline 372
	.dbline -2
L95:
	.dbline 0 ; func end
	ret
	.dbend
	.dbfunc e main _main fI
	.even
_main::
	.dbline -1
	.dbline 376
; }
; //----------------------------------主函数--------------------------------------
; main()
; {
	.dbline 378
; //------------------------------------------------------------------------------
; 	DDRD=0xb2;		  //
	ldi R24,178
	out 0x11,R24
	.dbline 379
; 	DDRB=0xB3;		  //
	ldi R24,179
	out 0x17,R24
	.dbline 380
; 	DDRA=0x1e;       //
	ldi R24,30
	out 0x1a,R24
	.dbline 381
; 	DDRC=0xff; 		//LED端口设置
	ldi R24,255
	out 0x14,R24
	.dbline 382
; 	PORTA = 0xff;
	out 0x1b,R24
	.dbline 383
; 	Hign_BELL;	
	sbi 0x12,5
	.dbline 383
	.dbline 384
; 	Hign_JDQ ;	
	sbi 0x12,7
	.dbline 386
; //------------------------------------------------------------------------------
; 	Spi_initial();
	xcall _Spi_initial
	.dbline 387
; 	system_Init();
	xcall _system_Init
	.dbline 388
; 	Config905();
	xcall _Config905
	.dbline 389
; 	Init_DS18B20();
	xcall _Init_DS18B20
	xjmp L100
L99:
	.dbline 391
	.dbline 392
	xcall _ReadTemperature
	.dbline 393
	xcall _work_temp
	.dbline 394
	xcall _dis_zhuye
	.dbline 395
	xcall _TX
	.dbline 396
L100:
	.dbline 390
	xjmp L99
X5:
	.dbline -2
L98:
	.dbline 0 ; func end
	ret
	.dbend
	.area bss(ram, con, rel)
	.dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线温度监控系统\FASONG\Wendu_fasong.c
_TxRxBuf::
	.blkb 4
	.dbsym e TxRxBuf _TxRxBuf A[4:4]c
_dispaly::
	.blkb 7
	.dbsym e dispaly _dispaly A[7:7]c
