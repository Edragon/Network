                        .module JASK_PCjieshou.c
                        .area text(rom, con, rel)
 0000                   .dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线PC控制系统\JASK_PCjieshou\JASK_PCjieshou.c
                        .area data(ram, con, rel)
 0000                   .dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线PC控制系统\JASK_PCjieshou\JASK_PCjieshou.c
 0000           _TxAddress::
 0000                   .blkb 2
                        .area idata
 0000 CCCC              .byte 204,204
                        .area data(ram, con, rel)
 0002                   .dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线PC控制系统\JASK_PCjieshou\JASK_PCjieshou.c
 0002                   .blkb 2
                        .area idata
 0002 CCCC              .byte 204,204
                        .area data(ram, con, rel)
 0004                   .dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线PC控制系统\JASK_PCjieshou\JASK_PCjieshou.c
 0004                   .dbsym e TxAddress _TxAddress A[4:4]c
 0004           _seg::
 0004                   .blkb 2
                        .area idata
 0004 C0CF              .byte 192,207
                        .area data(ram, con, rel)
 0006                   .dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线PC控制系统\JASK_PCjieshou\JASK_PCjieshou.c
 0006                   .blkb 2
                        .area idata
 0006 A4B0              .byte 164,176
                        .area data(ram, con, rel)
 0008                   .dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线PC控制系统\JASK_PCjieshou\JASK_PCjieshou.c
 0008                   .blkb 2
                        .area idata
 0008 9992              .byte 153,146
                        .area data(ram, con, rel)
 000A                   .dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线PC控制系统\JASK_PCjieshou\JASK_PCjieshou.c
 000A                   .blkb 2
                        .area idata
 000A 82F8              .byte 130,248
                        .area data(ram, con, rel)
 000C                   .dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线PC控制系统\JASK_PCjieshou\JASK_PCjieshou.c
 000C                   .blkb 2
                        .area idata
 000C 8090              .byte 128,144
                        .area data(ram, con, rel)
 000E                   .dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线PC控制系统\JASK_PCjieshou\JASK_PCjieshou.c
 000E                   .dbsym e seg _seg A[10:10]c
 000E           _RFConf::
 000E                   .blkb 2
                        .area idata
 000E 004C              .byte 0,'L
                        .area data(ram, con, rel)
 0010                   .dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线PC控制系统\JASK_PCjieshou\JASK_PCjieshou.c
 0010                   .blkb 2
                        .area idata
 0010 0C44              .byte 12,'D
                        .area data(ram, con, rel)
 0012                   .dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线PC控制系统\JASK_PCjieshou\JASK_PCjieshou.c
 0012                   .blkb 2
                        .area idata
 0012 0404              .byte 4,4
                        .area data(ram, con, rel)
 0014                   .dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线PC控制系统\JASK_PCjieshou\JASK_PCjieshou.c
 0014                   .blkb 2
                        .area idata
 0014 CCCC              .byte 204,204
                        .area data(ram, con, rel)
 0016                   .dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线PC控制系统\JASK_PCjieshou\JASK_PCjieshou.c
 0016                   .blkb 2
                        .area idata
 0016 CCCC              .byte 204,204
                        .area data(ram, con, rel)
 0018                   .dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线PC控制系统\JASK_PCjieshou\JASK_PCjieshou.c
 0018                   .blkb 1
                        .area idata
 0018 58                .byte 'X
                        .area data(ram, con, rel)
 0019                   .dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线PC控制系统\JASK_PCjieshou\JASK_PCjieshou.c
 0019                   .dbsym e RFConf _RFConf A[11:11]c
                        .area text(rom, con, rel)
 0000                   .dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线PC控制系统\JASK_PCjieshou\JASK_PCjieshou.c
 0000                   .dbfunc e Delay _Delay fV
 0000           ;              i -> R20,R21
 0000           ;              x -> R16,R17
                        .even
 0000           _Delay::
 0000 0E940000          xcall push_gset1
 0004                   .dbline -1
 0004                   .dbline 120
 0004           ; //ICC-AVR application builder : 2007-8-11 20:37:32
 0004           ; // Target : M16
 0004           ; // Crystal: 8.0000Mhz
 0004           ; #include <iom16v.h>
 0004           ; #include <macros.h>
 0004           ; #define uint  unsigned int
 0004           ; #define uchar unsigned char
 0004           ; //---------------------------------模式控制定义---------------------------------
 0004           ; //#define  nrf905_TX_EN         PB0       //输出1
 0004           ; #define   Hign_nrf905_TX_EN    PORTB |= (1 << PB0);   
 0004           ; #define   Low_nrf905_TX_EN     PORTB &= ~(1 << PB0); 
 0004           ; //#define  nrf905_TRX_CE  PD4     //输出1
 0004           ; #define   Hign_nrf905_TRX_CE    PORTD |= (1 << PD4);   
 0004           ; #define   Low_nrf905_TRX_CE     PORTD &= ~(1 << PD4); 
 0004           ; //#define  nrf905_PWR     PB1             //输出1
 0004           ; #define   Hign_nrf905_PWR    PORTB |= (1 << PB1);   
 0004           ; #define   Low_nrf905_PWR     PORTB &= ~(1 << PB1); 
 0004           ; //--------------------------------NRF905-SPI口接口定义--------------------------
 0004           ; //#define  nrf905_MISO          PB6           //输入0
 0004           ; //#define  nrf905_MOSI    PB5     //输出1
 0004           ; //#define  nrf905_SCK     PB7     //输出1
 0004           ; #define   Low_nrf905_SCK     PORTB &= ~(1 << PB7); 
 0004           ; //#define  nrf905_CSN     PB4         //输出1         
 0004           ; #define   Hign_nrf905_CSN    PORTB |= (1 << PB4);   
 0004           ; #define   Low_nrf905_CSN     PORTB &= ~(1 << PB4);                                            
 0004           ; //-------------------------------NRF905状态输出口-------------------------------
 0004           ; //#define  nrf905_CD      PD3     //输入0
 0004           ; #define   Hign_nrf905_CD    PORTD |= (1 << PD3);   
 0004           ; #define   Low_nrf905_CD     PORTD &= ~(1 << PD3); 
 0004           ; #define   Read_nrf905_CD    PINB & (1 << PD4);
 0004           ; //#define  nrf905_AM      PB3     //输入0
 0004           ; #define   Hign_nrf905_AM    PORTB |= (1 << PB3);   
 0004           ; #define   Low_nrf905_AM     PORTB &= ~(1 << PB3); 
 0004           ; #define   Read_nrf905_AM    PINB & (1 << PB3);
 0004           ; //#define  nrf905_DR      PB2                 //输入0
 0004           ; #define   Hign_nrf905_DR     PORTB |= (1 << PB2);   
 0004           ; #define   Low_nrf905_DR     PORTB &= ~(1 << PB2); 
 0004           ; #define   Read_nrf905_DR    PINB & (1 << PB2);   
 0004           ; //------------------------------LCD状态输出口-----------------------------------
 0004           ; //#define LCD_CS           PC7        //1-out
 0004           ; //#define   Out_LCD_CS       DDRC |= (1 << PC7);
 0004           ; #define   Hign_LCD_CS      PORTC |= (1 << PC7);   
 0004           ; #define   Low_LCD_CS       PORTC &= ~(1 << PC7); 
 0004           ; //#define LCD_RESET         PC6       //1-out
 0004           ; //#define   Out_CD_RESET      DDRC |= (1 << PC6);
 0004           ; #define   Hign_LCD_RESET    PORTC |= (1 << PC6);   
 0004           ; #define   Low_LCD_RESET     PORTC &= ~(1 << PC6); 
 0004           ; //#define LCD_RS           PC5        //1-out
 0004           ; //#define   Out_LCD_RS       DDRC |= (1 << PC5);
 0004           ; #define   Hign_LCD_RS      PORTC |= (1 << PC5);   
 0004           ; #define   Low_LCD_RS       PORTC &= ~(1 << PC5); 
 0004           ; //#define LCD_SCL        PC4  //1-out
 0004           ; //#define   Out_LCD_SCL      DDRC |= (1 << PC4); 
 0004           ; #define   Hign_LCD_SCL     PORTC |= (1 << PC4);   
 0004           ; #define   Low_LCD_SCL      PORTC &= ~(1 << PC4);
 0004           ; //#define LCD_SI         PC3          //1-ou
 0004           ; //#define   Out_LCD_SI      DDRC |= (1 << PC3); 
 0004           ; #define   Hign_LCD_SI    PORTC |= (1 << PC3);   
 0004           ; #define   Low_LCD_SI     PORTC &= ~(1 << PC3);
 0004           ; //-------------------------------BELL蜂明器-------------------------------------
 0004           ; #define   Hign_BELL  PORTD |= (1 << PD5)  
 0004           ; #define   Low_BELL     PORTD &= ~(1 << PD5) 
 0004           ; //-------------------------------JDQ继电器--------------------------------------
 0004           ; #define   Hign_JDQ  PORTD |= (1 << PD7)
 0004           ; #define   Low_JDQ     PORTD &= ~(1 << PD7)
 0004           ; //------------------------------数码管位选--------------------------------------
 0004           ; //#define Display1   PA1                  //输出1
 0004           ; #define   Hign_Display1     PORTA |= (1 << PA1);   
 0004           ; #define   Low_Display1    PORTA &= ~(1 << PA1); 
 0004           ; //#define Display2      PA2           //输出1
 0004           ; #define   Hign_Display2     PORTA |= (1 << PA2);   
 0004           ; #define   Low_Display2    PORTA &= ~(1 << PA2); 
 0004           ; //#define Display3     PA3            //输出1
 0004           ; #define   Hign_Display3     PORTA |= (1 << PA3);   
 0004           ; #define   Low_Display3     PORTA &= ~(1 << PA3); 
 0004           ; //#define Display4      PA4           //输出1
 0004           ; #define   Hign_Display4     PORTA |= (1 << PA4);   
 0004           ; #define   Low_Display4     PORTA &= ~(1 << PA4); 
 0004           ; //----------------------------------NRF905-SPI指令------------------------------
 0004           ; #define WC    0x00
 0004           ; #define RRC   0x10
 0004           ; #define WTP   0x20
 0004           ; #define RTP   0x21
 0004           ; #define WTA   0x22
 0004           ; #define RTA   0x23
 0004           ; #define RRP   0x24
 0004           ; //---------------------------------发送数据-------------------------------------
 0004           ; uchar TxRxBuffer[4];
 0004           ; //----------------------------------接收地址------------------------------------
 0004           ; uchar TxAddress[4]={0xcc,0xcc,0xcc,0xcc };    
 0004           ; //------------------------------------------------------------------------------
 0004           ; uchar count1,count2;
 0004           ; uchar seg[10]={0xC0,0xCF,0xA4,0xB0,0x99,0x92,0x82,0xF8,0x80,0x90};         //0~~9段码
 0004           ; //---------------------------------NRF905寄存器配置-----------------------------
 0004           ; uchar RFConf[11]=
 0004           ; {
 0004           ;   0x00,                            //配置命令//
 0004           ;   0x4c,                           //CH_NO,配置频段在430MHZ
 0004           ;   0x0C,                          //输出功率为10db,不重发，节电为正常模式
 0004           ;   0x44,                         //地址宽度设置，为4字节
 0004           ;   0x04,0x04,                   //接收发送有效数据长度为32字节
 0004           ;   0xCC,0xCC,0xCC,0xCC,        //接收地址
 0004           ;   0x58,                      //CRC充许，8位CRC校验，外部时钟信号不使能，16M晶振
 0004           ; };
 0004           ; //----------------------------------NRF905函数申明------------------------------
 0004           ; void Delay(uint x);                                                  //延时子程序                                                                                                                                                                                     
 0004           ; void Spi_initial();                            //SPI初始化
 0004           ; uchar SpiReadSpiWrite(unsigned char cData);    //SPI读写子程序
 0004           ; void system_Init(void);                                                  //系统初始化
 0004           ; void Config905(void);                                            //NRF905初始化子程序
 0004           ; void TxPacket(void);                                          
 0004           ; void SetTxMode(void);                                            //数据发送
 0004           ; void SetRxMode(void);                                            //
 0004           ; void TX(void);
 0004           ; unsigned char CheckDR(void);
 0004           ; void RxPacket(void);
 0004           ; void  RX(void);
 0004           ; //----------------------------------100us延时子程序-----------------------------
 0004           ; void Delay(uint x)
 0004           ; {
 0004 09C0              xjmp L3
 0006           L2:
 0006                   .dbline 123
 0006 4427              clr R20
 0008 5527              clr R21
 000A 02C0              xjmp L8
 000C           L5:
 000C                   .dbline 123
 000C           L6:
 000C                   .dbline 123
 000C 4F5F              subi R20,255  ; offset = 1
 000E 5F4F              sbci R21,255
 0010           L8:
 0010                   .dbline 123
 0010 4035              cpi R20,80
 0012 E0E0              ldi R30,0
 0014 5E07              cpc R21,R30
 0016 D0F3              brlo L5
 0018           L3:
 0018                   .dbline 122
 0018           ;       uint i;
 0018           ;       while(x--)
 0018 1801              movw R2,R16
 001A 0150              subi R16,1
 001C 1040              sbci R17,0
 001E 2220              tst R2
 0020 91F7              brne L2
 0022 3320              tst R3
 0024 81F7              brne L2
 0026           X0:
 0026                   .dbline -2
 0026           L1:
 0026 0E940000          xcall pop_gset1
 002A                   .dbline 0 ; func end
 002A 0895              ret
 002C                   .dbsym r i 20 i
 002C                   .dbsym r x 16 i
 002C                   .dbend
 002C                   .dbfunc e Spi_initial _Spi_initial fV
                        .even
 002C           _Spi_initial::
 002C                   .dbline -1
 002C                   .dbline 127
 002C           ;       for(i=0;i<80;i++);
 002C           ; }
 002C           ; //----------------------------------SPI初始化-----------------------------------
 002C           ; void Spi_initial()
 002C           ; {
 002C                   .dbline 128
 002C           ;       SPCR   = (1<<SPE)|(1<<MSTR)|(0<<CPOL)|(0<<SPR0);// 主机模式，fck/16, SPI方式0
 002C 80E5              ldi R24,80
 002E 8DB9              out 0xd,R24
 0030                   .dbline -2
 0030           L9:
 0030                   .dbline 0 ; func end
 0030 0895              ret
 0032                   .dbend
 0032                   .dbfunc e SpiReadSpiWrite _SpiReadSpiWrite fc
 0032           ;          cData -> R16
                        .even
 0032           _SpiReadSpiWrite::
 0032                   .dbline -1
 0032                   .dbline 132
 0032           ; }
 0032           ; //---------------------------------SPI读写程序----------------------------------      
 0032           ; uchar SpiReadSpiWrite(unsigned char cData)
 0032           ; {
 0032                   .dbline 133
 0032           ;       SPDR = cData;
 0032 0FB9              out 0xf,R16
 0034           L11:
 0034                   .dbline 135
 0034                   .dbline 135
 0034           L12:
 0034                   .dbline 134
 0034           ;       while(!(SPSR & (1<<SPIF) ))  // 等待SPI发送完毕
 0034 779B              sbis 0xe,7
 0036 FECF              rjmp L11
 0038                   .dbline 135
 0038           ;       {};                     
 0038                   .dbline 136
 0038           ;       return SPDR;
 0038 0FB1              in R16,0xf
 003A                   .dbline -2
 003A           L10:
 003A                   .dbline 0 ; func end
 003A 0895              ret
 003C                   .dbsym r cData 16 c
 003C                   .dbend
 003C                   .dbfunc e system_Init _system_Init fV
                        .even
 003C           _system_Init::
 003C                   .dbline -1
 003C                   .dbline 140
 003C           ; }
 003C           ; //--------------------------------系统状态初始化--------------------------------
 003C           ; void system_Init(void)                        
 003C           ; {
 003C                   .dbline 142
 003C           ; 
 003C           ;       Hign_nrf905_CSN;                        // SPI使能
 003C C49A              sbi 0x18,4
 003E                   .dbline 142
 003E                   .dbline 143
 003E           ;       Low_nrf905_SCK;                         
 003E C798              cbi 0x18,7
 0040                   .dbline 143
 0040                   .dbline 144
 0040           ;       Low_nrf905_DR;                          // DR=0
 0040 C298              cbi 0x18,2
 0042                   .dbline 144
 0042                   .dbline 145
 0042           ;       Low_nrf905_AM;                          // AM=0
 0042 C398              cbi 0x18,3
 0044                   .dbline 145
 0044                   .dbline 146
 0044           ;       Low_nrf905_CD;                          // CD=0
 0044 9398              cbi 0x12,3
 0046                   .dbline 146
 0046                   .dbline 147
 0046           ;       Hign_nrf905_PWR;                    // PWR=1
 0046 C19A              sbi 0x18,1
 0048                   .dbline 147
 0048                   .dbline 148
 0048           ;       Low_nrf905_TRX_CE;                      // nrf905_TRX_CE=0
 0048 9498              cbi 0x12,4
 004A                   .dbline 148
 004A                   .dbline 149
 004A           ;       Low_nrf905_TX_EN ;                      // nrf905_TX_EN=0
 004A C098              cbi 0x18,0
 004C                   .dbline 149
 004C                   .dbline -2
 004C           L14:
 004C                   .dbline 0 ; func end
 004C 0895              ret
 004E                   .dbend
 004E                   .dbfunc e Config905 _Config905 fV
 004E           ;              i -> R20
                        .even
 004E           _Config905::
 004E 0E940000          xcall push_gset1
 0052                   .dbline -1
 0052                   .dbline 153
 0052           ; }
 0052           ; //--------------------------------NRF905寄存器初始化函数------------------------
 0052           ; void Config905(void)
 0052           ; {
 0052                   .dbline 155
 0052           ;       uchar i;
 0052           ;       Low_nrf905_CSN;                         //SPI使能                                                                                       
 0052 C498              cbi 0x18,4
 0054                   .dbline 155
 0054                   .dbline 156
 0054           ;       Delay(1);                                  
 0054 01E0              ldi R16,1
 0056 10E0              ldi R17,0
 0058 D3DF              xcall _Delay
 005A                   .dbline 157
 005A           ;       for (i=0;i<11;i++)                      //NRF905配置字
 005A 4427              clr R20
 005C 09C0              xjmp L19
 005E           L16:
 005E                   .dbline 158
 005E                   .dbline 159
 005E 80E0              ldi R24,<_RFConf
 0060 90E0              ldi R25,>_RFConf
 0062 E42F              mov R30,R20
 0064 FF27              clr R31
 0066 E80F              add R30,R24
 0068 F91F              adc R31,R25
 006A 0081              ldd R16,z+0
 006C E2DF              xcall _SpiReadSpiWrite
 006E                   .dbline 160
 006E           L17:
 006E                   .dbline 157
 006E 4395              inc R20
 0070           L19:
 0070                   .dbline 157
 0070 4B30              cpi R20,11
 0072 A8F3              brlo L16
 0074                   .dbline 161
 0074           ;       {
 0074           ;        SpiReadSpiWrite(RFConf[i]);
 0074           ;       }
 0074           ;       Hign_nrf905_CSN;                                        // Disable Spi
 0074 C49A              sbi 0x18,4
 0076                   .dbline 161
 0076                   .dbline -2
 0076           L15:
 0076 0E940000          xcall pop_gset1
 007A                   .dbline 0 ; func end
 007A 0895              ret
 007C                   .dbsym r i 20 c
 007C                   .dbend
 007C                   .dbfunc e TxPacket _TxPacket fV
 007C           ;              i -> R20
                        .even
 007C           _TxPacket::
 007C 0E940000          xcall push_gset1
 0080                   .dbline -1
 0080                   .dbline 165
 0080           ; }
 0080           ; //--------------------------------NRF905待发数据打包----------------------------
 0080           ; void TxPacket(void)
 0080           ; {
 0080                   .dbline 167
 0080           ;       uchar i;
 0080           ;       Low_nrf905_CSN;                                         // 使能Spi，允许对nrf905进行读写操作
 0080 C498              cbi 0x18,4
 0082                   .dbline 167
 0082                   .dbline 168
 0082           ;       Delay(1);
 0082 01E0              ldi R16,1
 0084 10E0              ldi R17,0
 0086 BCDF              xcall _Delay
 0088                   .dbline 169
 0088           ;       SpiReadSpiWrite(WTP);                           // 写数据前先写写数据命令
 0088 00E2              ldi R16,32
 008A D3DF              xcall _SpiReadSpiWrite
 008C                   .dbline 170
 008C           ;       for (i=0;i<32;i++)
 008C 4427              clr R20
 008E 09C0              xjmp L24
 0090           L21:
 0090                   .dbline 171
 0090                   .dbline 172
 0090 80E0              ldi R24,<_TxRxBuffer
 0092 90E0              ldi R25,>_TxRxBuffer
 0094 E42F              mov R30,R20
 0096 FF27              clr R31
 0098 E80F              add R30,R24
 009A F91F              adc R31,R25
 009C 0081              ldd R16,z+0
 009E C9DF              xcall _SpiReadSpiWrite
 00A0                   .dbline 173
 00A0           L22:
 00A0                   .dbline 170
 00A0 4395              inc R20
 00A2           L24:
 00A2                   .dbline 170
 00A2 4032              cpi R20,32
 00A4 A8F3              brlo L21
 00A6                   .dbline 174
 00A6           ;       {
 00A6           ;       SpiReadSpiWrite(TxRxBuffer[i]);         // 待发送的32字节数据
 00A6           ;       }                                               
 00A6           ;       Hign_nrf905_CSN;
 00A6 C49A              sbi 0x18,4
 00A8                   .dbline 174
 00A8                   .dbline 175
 00A8           ;       Delay(1);                                                       // 关闭Spi，不允许对nrf905进行读写操作
 00A8 01E0              ldi R16,1
 00AA 10E0              ldi R17,0
 00AC A9DF              xcall _Delay
 00AE                   .dbline 176
 00AE           ;       Low_nrf905_CSN;                                         // 使能Spi
 00AE C498              cbi 0x18,4
 00B0                   .dbline 176
 00B0                   .dbline 177
 00B0           ;       SpiReadSpiWrite(WTA);                           // 写地址前首先先写地址命令
 00B0 02E2              ldi R16,34
 00B2 BFDF              xcall _SpiReadSpiWrite
 00B4                   .dbline 178
 00B4           ;       for (i=0;i<4;i++)                                       // 写入4 bytes 接收地址
 00B4 4427              clr R20
 00B6 09C0              xjmp L28
 00B8           L25:
 00B8                   .dbline 179
 00B8                   .dbline 180
 00B8 80E0              ldi R24,<_TxAddress
 00BA 90E0              ldi R25,>_TxAddress
 00BC E42F              mov R30,R20
 00BE FF27              clr R31
 00C0 E80F              add R30,R24
 00C2 F91F              adc R31,R25
 00C4 0081              ldd R16,z+0
 00C6 B5DF              xcall _SpiReadSpiWrite
 00C8                   .dbline 181
 00C8           L26:
 00C8                   .dbline 178
 00C8 4395              inc R20
 00CA           L28:
 00CA                   .dbline 178
 00CA 4430              cpi R20,4
 00CC A8F3              brlo L25
 00CE                   .dbline 182
 00CE           ;       {
 00CE           ;       SpiReadSpiWrite(TxAddress[i]);
 00CE           ;       }
 00CE           ;       Hign_nrf905_CSN;                                        // 关闭Spi
 00CE C49A              sbi 0x18,4
 00D0                   .dbline 182
 00D0                   .dbline 183
 00D0           ;       Hign_nrf905_TRX_CE;                                     // Set TRX_CE high,start Tx data transmission
 00D0 949A              sbi 0x12,4
 00D2                   .dbline 183
 00D2                   .dbline 184
 00D2           ;       Delay(1);                                                       // 等待DR变高
 00D2 01E0              ldi R16,1
 00D4 10E0              ldi R17,0
 00D6 94DF              xcall _Delay
 00D8                   .dbline 185
 00D8           ;       Low_nrf905_TRX_CE;                                      // 设置TRX_CE=0
 00D8 9498              cbi 0x12,4
 00DA                   .dbline 185
 00DA                   .dbline -2
 00DA           L20:
 00DA 0E940000          xcall pop_gset1
 00DE                   .dbline 0 ; func end
 00DE 0895              ret
 00E0                   .dbsym r i 20 c
 00E0                   .dbend
 00E0                   .dbfunc e SetTxMode _SetTxMode fV
                        .even
 00E0           _SetTxMode::
 00E0                   .dbline -1
 00E0                   .dbline 189
 00E0           ; }
 00E0           ; //------------------------------设置发送模式------------------------------------
 00E0           ; void SetTxMode(void)
 00E0           ; {
 00E0                   .dbline 190
 00E0           ;       Low_nrf905_TRX_CE;                              //
 00E0 9498              cbi 0x12,4
 00E2                   .dbline 190
 00E2                   .dbline 191
 00E2           ;       Hign_nrf905_TX_EN;                              //发送使能
 00E2 C09A              sbi 0x18,0
 00E4                   .dbline 191
 00E4                   .dbline 192
 00E4           ;       Delay(2);                               // delay for mode change(>=650us)
 00E4 02E0              ldi R16,2
 00E6 10E0              ldi R17,0
 00E8 8BDF              xcall _Delay
 00EA                   .dbline -2
 00EA           L29:
 00EA                   .dbline 0 ; func end
 00EA 0895              ret
 00EC                   .dbend
 00EC                   .dbfunc e SetRxMode _SetRxMode fV
                        .even
 00EC           _SetRxMode::
 00EC                   .dbline -1
 00EC                   .dbline 196
 00EC           ; }
 00EC           ; //------------------------------设置接收模式激发--------------------------------
 00EC           ; void SetRxMode(void)
 00EC           ; {
 00EC                   .dbline 197
 00EC           ;       Low_nrf905_TX_EN;
 00EC C098              cbi 0x18,0
 00EE                   .dbline 197
 00EE                   .dbline 198
 00EE           ;       Hign_nrf905_TRX_CE;
 00EE 949A              sbi 0x12,4
 00F0                   .dbline 198
 00F0                   .dbline 199
 00F0           ;       Delay(10);                                      // delay for mode change(>=650us)
 00F0 0AE0              ldi R16,10
 00F2 10E0              ldi R17,0
 00F4 85DF              xcall _Delay
 00F6                   .dbline -2
 00F6           L30:
 00F6                   .dbline 0 ; func end
 00F6 0895              ret
 00F8                   .dbend
 00F8                   .dbfunc e TX _TX fV
                        .even
 00F8           _TX::
 00F8                   .dbline -1
 00F8                   .dbline 203
 00F8           ; }
 00F8           ; //------------------------------发送数据----------------------------------------
 00F8           ; void TX(void)
 00F8           ; {
 00F8                   .dbline 204
 00F8           ;      SetTxMode();        // Set nRF905 in Tx mode
 00F8 F3DF              xcall _SetTxMode
 00FA                   .dbline 205
 00FA           ;        TxPacket();                       // Send data by nRF905
 00FA C0DF              xcall _TxPacket
 00FC                   .dbline -2
 00FC           L31:
 00FC                   .dbline 0 ; func end
 00FC 0895              ret
 00FE                   .dbend
 00FE                   .dbfunc e CheckDR _CheckDR fc
                        .even
 00FE           _CheckDR::
 00FE                   .dbline -1
 00FE                   .dbline 209
 00FE           ; }
 00FE           ; //-----------------------------判断是否收到数据---------------------------------
 00FE           ; unsigned char CheckDR(void)           //检查是否有新数据传入 
 00FE           ; {
 00FE                   .dbline 210
 00FE           ;       if (PINB & (1 << PB2))
 00FE B29B              sbis 0x16,2
 0100 02C0              rjmp L33
 0102                   .dbline 211
 0102           ;       {
 0102                   .dbline 212
 0102           ;               return 1;                               //收到数据
 0102 01E0              ldi R16,1
 0104 01C0              xjmp L32
 0106           L33:
 0106                   .dbline 215
 0106           ;       }
 0106           ;       else
 0106           ;       {
 0106                   .dbline 216
 0106           ;               return 0;
 0106 0027              clr R16
 0108                   .dbline -2
 0108           L32:
 0108                   .dbline 0 ; func end
 0108 0895              ret
 010A                   .dbend
 010A                   .dbfunc e RxPacket _RxPacket fV
 010A           ;              i -> R20
                        .even
 010A           _RxPacket::
 010A 0E940000          xcall push_gset1
 010E                   .dbline -1
 010E                   .dbline 221
 010E           ;       }
 010E           ; }
 010E           ; //-----------------------------------读接收数据包-------------------------------
 010E           ; void RxPacket(void)                                                   //读数据
 010E           ; {
 010E                   .dbline 223
 010E           ;       uchar i;
 010E           ;     Low_nrf905_TRX_CE;
 010E 9498              cbi 0x12,4
 0110                   .dbline 223
 0110                   .dbline 224
 0110           ;       Low_nrf905_CSN;                                             // 使能SPI
 0110 C498              cbi 0x18,4
 0112                   .dbline 224
 0112                   .dbline 225
 0112           ;     Delay(1);
 0112 01E0              ldi R16,1
 0114 10E0              ldi R17,0
 0116 74DF              xcall _Delay
 0118                   .dbline 226
 0118           ;       SpiReadSpiWrite(RRP);                              // 写入数据接收缓冲区数据命令
 0118 04E2              ldi R16,36
 011A 8BDF              xcall _SpiReadSpiWrite
 011C                   .dbline 227
 011C           ;       for (i = 0 ;i < 4 ;i++)
 011C 4427              clr R20
 011E 0AC0              xjmp L39
 0120           L36:
 0120                   .dbline 228
 0120                   .dbline 229
 0120 0027              clr R16
 0122 87DF              xcall _SpiReadSpiWrite
 0124 80E0              ldi R24,<_TxRxBuffer
 0126 90E0              ldi R25,>_TxRxBuffer
 0128 E42F              mov R30,R20
 012A FF27              clr R31
 012C E80F              add R30,R24
 012E F91F              adc R31,R25
 0130 0083              std z+0,R16
 0132                   .dbline 230
 0132           L37:
 0132                   .dbline 227
 0132 4395              inc R20
 0134           L39:
 0134                   .dbline 227
 0134 4430              cpi R20,4
 0136 A0F3              brlo L36
 0138                   .dbline 231
 0138           ;       {   
 0138           ;       TxRxBuffer[i]=SpiReadSpiWrite(0);         // 读取数据接收缓冲区数据       
 0138           ;       }
 0138           ;       Hign_nrf905_CSN;
 0138 C49A              sbi 0x18,4
 013A                   .dbline 231
 013A                   .dbline 232
 013A           ;     Delay(2);                            //
 013A 02E0              ldi R16,2
 013C 10E0              ldi R17,0
 013E 60DF              xcall _Delay
 0140                   .dbline 233
 0140           ;       Hign_nrf905_TRX_CE;                                                     
 0140 949A              sbi 0x12,4
 0142                   .dbline 233
 0142                   .dbline -2
 0142           L35:
 0142 0E940000          xcall pop_gset1
 0146                   .dbline 0 ; func end
 0146 0895              ret
 0148                   .dbsym r i 20 c
 0148                   .dbend
 0148                   .dbfunc e RX _RX fV
                        .even
 0148           _RX::
 0148                   .dbline -1
 0148                   .dbline 237
 0148           ; }
 0148           ; //--------------------------------设置接收模式----------------------------------
 0148           ; void  RX(void)
 0148           ; {
 0148                   .dbline 238
 0148           ;     SetRxMode();                                //设置NRF905接收模式
 0148 D1DF              xcall _SetRxMode
 014A                   .dbline 240
 014A           ;     //while (CheckDR()==0);            //等待接收完成
 014A           ;       RxPacket();                     //读取接收数据缓冲区
 014A DFDF              xcall _RxPacket
 014C                   .dbline 241
 014C           ;       Delay(10);
 014C 0AE0              ldi R16,10
 014E 10E0              ldi R17,0
 0150 57DF              xcall _Delay
 0152                   .dbline -2
 0152           L40:
 0152                   .dbline 0 ; func end
 0152 0895              ret
 0154                   .dbend
 0154                   .dbfunc e dis_zhuye _dis_zhuye fV
                        .even
 0154           _dis_zhuye::
 0154                   .dbline -1
 0154                   .dbline 245
 0154           ; }
 0154           ; //-------------------------------主界面显示--------------------------------------
 0154           ; void  dis_zhuye()
 0154           ; {
 0154                   .dbline 246
 0154           ;        PORTC=seg[count2/10];
 0154 2AE0              ldi R18,10
 0156 30E0              ldi R19,0
 0158 00910000          lds R16,_count2
 015C 1127              clr R17
 015E 0E940000          xcall div16s
 0162 F801              movw R30,R16
 0164 80E0              ldi R24,<_seg
 0166 90E0              ldi R25,>_seg
 0168 E80F              add R30,R24
 016A F91F              adc R31,R25
 016C 2080              ldd R2,z+0
 016E 25BA              out 0x15,R2
 0170                   .dbline 247
 0170           ;        Hign_Display4;
 0170 DC9A              sbi 0x1b,4
 0172                   .dbline 247
 0172                   .dbline 248
 0172           ;        Hign_Display3;
 0172 DB9A              sbi 0x1b,3
 0174                   .dbline 248
 0174                   .dbline 249
 0174           ;        Hign_Display2;
 0174 DA9A              sbi 0x1b,2
 0176                   .dbline 249
 0176                   .dbline 250
 0176           ;        Low_Display1;
 0176 D998              cbi 0x1b,1
 0178                   .dbline 250
 0178                   .dbline 251
 0178           ;        Delay(80);
 0178 00E5              ldi R16,80
 017A 10E0              ldi R17,0
 017C 41DF              xcall _Delay
 017E                   .dbline 252
 017E           ;        Hign_Display1;
 017E D99A              sbi 0x1b,1
 0180                   .dbline 252
 0180                   .dbline 254
 0180           ; //------------------------------------------------------------------------------
 0180           ;        PORTC=seg[count2%10];
 0180 2AE0              ldi R18,10
 0182 30E0              ldi R19,0
 0184 00910000          lds R16,_count2
 0188 1127              clr R17
 018A 0E940000          xcall mod16s
 018E F801              movw R30,R16
 0190 80E0              ldi R24,<_seg
 0192 90E0              ldi R25,>_seg
 0194 E80F              add R30,R24
 0196 F91F              adc R31,R25
 0198 2080              ldd R2,z+0
 019A 25BA              out 0x15,R2
 019C                   .dbline 255
 019C           ;        Low_Display2;
 019C DA98              cbi 0x1b,2
 019E                   .dbline 255
 019E                   .dbline 256
 019E           ;        Delay(80);
 019E 00E5              ldi R16,80
 01A0 10E0              ldi R17,0
 01A2 2EDF              xcall _Delay
 01A4                   .dbline 257
 01A4           ;        Hign_Display2;
 01A4 DA9A              sbi 0x1b,2
 01A6                   .dbline 257
 01A6                   .dbline 259
 01A6           ; //------------------------------------------------ ---------------------------
 01A6           ;        PORTC=seg[count1/10];
 01A6 2AE0              ldi R18,10
 01A8 30E0              ldi R19,0
 01AA 00910100          lds R16,_count1
 01AE 1127              clr R17
 01B0 0E940000          xcall div16s
 01B4 F801              movw R30,R16
 01B6 80E0              ldi R24,<_seg
 01B8 90E0              ldi R25,>_seg
 01BA E80F              add R30,R24
 01BC F91F              adc R31,R25
 01BE 2080              ldd R2,z+0
 01C0 25BA              out 0x15,R2
 01C2                   .dbline 260
 01C2           ;        Low_Display3;
 01C2 DB98              cbi 0x1b,3
 01C4                   .dbline 260
 01C4                   .dbline 261
 01C4           ;        Delay(80);
 01C4 00E5              ldi R16,80
 01C6 10E0              ldi R17,0
 01C8 1BDF              xcall _Delay
 01CA                   .dbline 262
 01CA           ;        Hign_Display3;
 01CA DB9A              sbi 0x1b,3
 01CC                   .dbline 262
 01CC                   .dbline 264
 01CC           ; //----------------------------------------------------------------------------- 
 01CC           ;        PORTC=seg[count1%10];
 01CC 2AE0              ldi R18,10
 01CE 30E0              ldi R19,0
 01D0 00910100          lds R16,_count1
 01D4 1127              clr R17
 01D6 0E940000          xcall mod16s
 01DA F801              movw R30,R16
 01DC 80E0              ldi R24,<_seg
 01DE 90E0              ldi R25,>_seg
 01E0 E80F              add R30,R24
 01E2 F91F              adc R31,R25
 01E4 2080              ldd R2,z+0
 01E6 25BA              out 0x15,R2
 01E8                   .dbline 265
 01E8           ;        Low_Display4;
 01E8 DC98              cbi 0x1b,4
 01EA                   .dbline 265
 01EA                   .dbline 266
 01EA           ;        Delay(80);
 01EA 00E5              ldi R16,80
 01EC 10E0              ldi R17,0
 01EE 08DF              xcall _Delay
 01F0                   .dbline 267
 01F0           ;        Hign_Display4;   
 01F0 DC9A              sbi 0x1b,4
 01F2                   .dbline 267
 01F2                   .dbline -2
 01F2           L41:
 01F2                   .dbline 0 ; func end
 01F2 0895              ret
 01F4                   .dbend
 01F4                   .dbfunc e main _main fV
 01F4           ;              i -> <dead>
                        .even
 01F4           _main::
 01F4                   .dbline -1
 01F4                   .dbline 271
 01F4           ; }
 01F4           ; //------------------------------主函数------------------------------------------
 01F4           ; void main(void)
 01F4           ; {  
 01F4                   .dbline 274
 01F4           ;       uint i; 
 01F4           ; //------------------------------------------------------------------------------
 01F4           ;       DDRD=0xb2;                //
 01F4 82EB              ldi R24,178
 01F6 81BB              out 0x11,R24
 01F8                   .dbline 275
 01F8           ;       DDRB=0xB3;                //
 01F8 83EB              ldi R24,179
 01FA 87BB              out 0x17,R24
 01FC                   .dbline 276
 01FC           ;       DDRA=0x1e;       //
 01FC 8EE1              ldi R24,30
 01FE 8ABB              out 0x1a,R24
 0200                   .dbline 277
 0200           ;       DDRC=0xff;              //LED端口设置
 0200 8FEF              ldi R24,255
 0202 84BB              out 0x14,R24
 0204                   .dbline 278
 0204           ;       PORTA = 0xff;
 0204 8BBB              out 0x1b,R24
 0206                   .dbline 279
 0206           ;       Hign_BELL;      
 0206 959A              sbi 0x12,5
 0208                   .dbline 280
 0208           ;       Hign_JDQ ;
 0208 979A              sbi 0x12,7
 020A                   .dbline 282
 020A           ; //------------------------------------------------------------------------------
 020A           ;       Hign_BELL ;
 020A 959A              sbi 0x12,5
 020C                   .dbline 283
 020C           ;       Hign_JDQ;
 020C 979A              sbi 0x12,7
 020E                   .dbline 285
 020E           ; //------------------------------------------------------------------------------                                                                                      
 020E           ;       Spi_initial();                  //SPI初始化                                                                                                                       
 020E 0EDF              xcall _Spi_initial
 0210                   .dbline 286
 0210           ;       system_Init();                             //系统状态初始化                                                                                             
 0210 15DF              xcall _system_Init
 0212                   .dbline 287
 0212           ;       Config905();                              //NRF905初始化                                                  
 0212 1DDF              xcall _Config905
 0214                   .dbline 289
 0214           ; //------------------------------------------------------------------------------ 
 0214           ;       Delay(6000);
 0214 00E7              ldi R16,6000
 0216 17E1              ldi R17,23
 0218 F3DE              xcall _Delay
 021A                   .dbline 290
 021A           ;               dis_zhuye();    
 021A 9CDF              xcall _dis_zhuye
 021C 5BC0              xjmp L44
 021E           L43:
 021E                   .dbline 293
 021E           ; //------------------------------------------------------------------------------
 021E           ;       while(1)
 021E           ;       {
 021E                   .dbline 294
 021E           ;       RX();                                   //接收数据
 021E 94DF              xcall _RX
 0220                   .dbline 295
 0220           ;       if(TxRxBuffer[0])
 0220 20900200          lds R2,_TxRxBuffer
 0224 2220              tst R2
 0226 09F4              brne X2
 0228 4FC0              xjmp L46
 022A           X2:
 022A                   .dbline 296
 022A           ;       {
 022A                   .dbline 298
 022A           ;       
 022A           ;               if(TxRxBuffer[0]==0x11)              //A队+1
 022A 822D              mov R24,R2
 022C 8131              cpi R24,17
 022E 31F4              brne L48
 0230                   .dbline 299
 0230           ;                       {
 0230                   .dbline 300
 0230           ;                       count1=count1+1;
 0230 80910100          lds R24,_count1
 0234 8F5F              subi R24,255    ; addi 1
 0236 80930100          sts _count1,R24
 023A                   .dbline 301
 023A           ;                       Low_BELL;
 023A 9598              cbi 0x12,5
 023C                   .dbline 302
 023C           ;                       }
 023C           L48:
 023C                   .dbline 303
 023C           ;               if(TxRxBuffer[0]==0x21)             //A队+2
 023C 80910200          lds R24,_TxRxBuffer
 0240 8132              cpi R24,33
 0242 31F4              brne L50
 0244                   .dbline 304
 0244           ;                       {
 0244                   .dbline 305
 0244           ;                       count1=count1+2;
 0244 80910100          lds R24,_count1
 0248 8E5F              subi R24,254    ; addi 2
 024A 80930100          sts _count1,R24
 024E                   .dbline 306
 024E           ;                       Low_JDQ;
 024E 9798              cbi 0x12,7
 0250                   .dbline 307
 0250           ;                       }
 0250           L50:
 0250                   .dbline 308
 0250           ;               if(TxRxBuffer[0]==0x31)            //A队+3
 0250 80910200          lds R24,_TxRxBuffer
 0254 8133              cpi R24,49
 0256 31F4              brne L52
 0258                   .dbline 309
 0258           ;                       {
 0258                   .dbline 310
 0258           ;                       count1=count1+3;
 0258 80910100          lds R24,_count1
 025C 8D5F              subi R24,253    ; addi 3
 025E 80930100          sts _count1,R24
 0262                   .dbline 311
 0262           ;                       Low_BELL;
 0262 9598              cbi 0x12,5
 0264                   .dbline 312
 0264           ;                       }
 0264           L52:
 0264                   .dbline 313
 0264           ;               if(TxRxBuffer[0]==0x41)           //B队+1
 0264 80910200          lds R24,_TxRxBuffer
 0268 8134              cpi R24,65
 026A 31F4              brne L54
 026C                   .dbline 314
 026C           ;                       {
 026C                   .dbline 315
 026C           ;                       count2=count2+1;
 026C 80910000          lds R24,_count2
 0270 8F5F              subi R24,255    ; addi 1
 0272 80930000          sts _count2,R24
 0276                   .dbline 316
 0276           ;                       Low_JDQ;
 0276 9798              cbi 0x12,7
 0278                   .dbline 317
 0278           ;                       }
 0278           L54:
 0278                   .dbline 318
 0278           ;               if(TxRxBuffer[0]==0x51)          //B队+2
 0278 80910200          lds R24,_TxRxBuffer
 027C 8135              cpi R24,81
 027E 31F4              brne L56
 0280                   .dbline 319
 0280           ;                       {
 0280                   .dbline 320
 0280           ;                       count2=count2+2;
 0280 80910000          lds R24,_count2
 0284 8E5F              subi R24,254    ; addi 2
 0286 80930000          sts _count2,R24
 028A                   .dbline 321
 028A           ;                       Low_BELL;
 028A 9598              cbi 0x12,5
 028C                   .dbline 322
 028C           ;                       }
 028C           L56:
 028C                   .dbline 323
 028C           ;               if(TxRxBuffer[0]==0x61)         //B队+3
 028C 80910200          lds R24,_TxRxBuffer
 0290 8136              cpi R24,97
 0292 31F4              brne L58
 0294                   .dbline 324
 0294           ;                       {
 0294                   .dbline 325
 0294           ;                       count2=count2+3;
 0294 80910000          lds R24,_count2
 0298 8D5F              subi R24,253    ; addi 3
 029A 80930000          sts _count2,R24
 029E                   .dbline 326
 029E           ;                       Low_JDQ;
 029E 9798              cbi 0x12,7
 02A0                   .dbline 327
 02A0           ;                       }
 02A0           L58:
 02A0                   .dbline 328
 02A0           ;               if(TxRxBuffer[0]==0x71)        //B队-1
 02A0 80910200          lds R24,_TxRxBuffer
 02A4 8137              cpi R24,113
 02A6 31F4              brne L60
 02A8                   .dbline 329
 02A8           ;                       {
 02A8                   .dbline 330
 02A8           ;                       count1=count1-1;
 02A8 80910100          lds R24,_count1
 02AC 8150              subi R24,1
 02AE 80930100          sts _count1,R24
 02B2                   .dbline 331
 02B2           ;                       Low_BELL;
 02B2 9598              cbi 0x12,5
 02B4                   .dbline 332
 02B4           ;                       }
 02B4           L60:
 02B4                   .dbline 333
 02B4           ;               if(TxRxBuffer[0]==0x91)       //B队-1
 02B4 80910200          lds R24,_TxRxBuffer
 02B8 8139              cpi R24,145
 02BA 31F4              brne L62
 02BC                   .dbline 334
 02BC           ;                       {
 02BC                   .dbline 335
 02BC           ;                       count2=count2-1;
 02BC 80910000          lds R24,_count2
 02C0 8150              subi R24,1
 02C2 80930000          sts _count2,R24
 02C6                   .dbline 336
 02C6           ;                       Low_BELL;
 02C6 9598              cbi 0x12,5
 02C8                   .dbline 337
 02C8           ;                       }
 02C8           L62:
 02C8                   .dbline 339
 02C8           ;       
 02C8           ;       }
 02C8           L46:
 02C8                   .dbline 340
 02C8 45DF              xcall _dis_zhuye
 02CA                   .dbline 341
 02CA 959A              sbi 0x12,5
 02CC                   .dbline 342
 02CC 979A              sbi 0x12,7
 02CE                   .dbline 343
 02CE 2224              clr R2
 02D0 20920200          sts _TxRxBuffer,R2
 02D4                   .dbline 344
 02D4           L44:
 02D4                   .dbline 292
 02D4 A4CF              xjmp L43
 02D6           X1:
 02D6                   .dbline -2
 02D6           L42:
 02D6                   .dbline 0 ; func end
 02D6 0895              ret
 02D8                   .dbsym l i 1 i
 02D8                   .dbend
                        .area bss(ram, con, rel)
 0000                   .dbfile C:\DOCUME~1\Administrator\桌面\JASK2001软件开发包\M16-NRF905开发包\无线PC控制系统\JASK_PCjieshou\JASK_PCjieshou.c
 0000           _count2::
 0000                   .blkb 1
 0001                   .dbsym e count2 _count2 c
 0001           _count1::
 0001                   .blkb 1
 0002                   .dbsym e count1 _count1 c
 0002           _TxRxBuffer::
 0002                   .blkb 4
 0006                   .dbsym e TxRxBuffer _TxRxBuffer A[4:4]c
